---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const aboutPages = await getCollection('about');

  return aboutPages
    .filter((page) => page.id !== 'index.md' && page.id !== 'index')
    .map((page) => {
      let slug = page.id
        .replace(/\/index\.md$/, '')
        .replace(/\.md$/, '')
        .replace(/\/index$/, '');
      return {
        params: { slug },
        props: { page },
      };
    });
}

const { page } = Astro.props;
const { Content } = await render(page);

const slugParts = Astro.params.slug?.split('/') || [];
---

<BaseLayout title={page.data.title}>
  <nav class="nr-breadcrumbs" aria-label="Breadcrumb">
    <ol class="nr-breadcrumbs-inner">
      <li><a href="/" class="nr-breadcrumbs-link">Node-RED</a></li>
      <li><a href="/about/" class="nr-breadcrumbs-link">About</a></li>
      {slugParts.map((part, i) => (
        <li>
          {i === slugParts.length - 1 ? (
            <span aria-current="page" class="text-white">{part}</span>
          ) : (
            <a href={`/about/${slugParts.slice(0, i + 1).join('/')}/`} class="nr-breadcrumbs-link">{part}</a>
          )}
        </li>
      ))}
    </ol>
  </nav>

  <div class="max-w-[1200px] mx-auto py-[30px] px-5 grid grid-cols-[250px_1fr] gap-10 lt-md:grid-cols-1">
    <aside class="lt-md:order-2">
      <nav aria-label="About section">
        <ul class="list-none p-0 m-0">
          <li><a href="/about/" class="block py-2.5 px-[15px] no-underline border-l-4 transition-all duration-200 border-[#eee] text-[#666] hover:border-l-nr-red hover:bg-nr-bg-light">About Node-RED</a></li>
          <li><a href="/about/community/" class:list={['block py-2.5 px-[15px] no-underline border-l-4 transition-all duration-200', Astro.params.slug?.startsWith('community') ? 'border-l-nr-red bg-white font-semibold text-[#666]' : 'border-[#eee] text-[#666] hover:border-l-nr-red hover:bg-nr-bg-light']}>Community</a></li>
          <li><a href="/about/contribute/" class:list={['block py-2.5 px-[15px] no-underline border-l-4 transition-all duration-200', Astro.params.slug === 'contribute' ? 'border-l-nr-red bg-white font-semibold text-[#666]' : 'border-[#eee] text-[#666] hover:border-l-nr-red hover:bg-nr-bg-light']}>Contribute</a></li>
          <li><a href="/about/governance/" class:list={['block py-2.5 px-[15px] no-underline border-l-4 transition-all duration-200', Astro.params.slug === 'governance' ? 'border-l-nr-red bg-white font-semibold text-[#666]' : 'border-[#eee] text-[#666] hover:border-l-nr-red hover:bg-nr-bg-light']}>Governance</a></li>
          <li><a href="/about/license/" class:list={['block py-2.5 px-[15px] no-underline border-l-4 transition-all duration-200', Astro.params.slug === 'license' ? 'border-l-nr-red bg-white font-semibold text-[#666]' : 'border-[#eee] text-[#666] hover:border-l-nr-red hover:bg-nr-bg-light']}>License</a></li>
          <li><a href="/about/releases/" class:list={['block py-2.5 px-[15px] no-underline border-l-4 transition-all duration-200', Astro.params.slug === 'releases' ? 'border-l-nr-red bg-white font-semibold text-[#666]' : 'border-[#eee] text-[#666] hover:border-l-nr-red hover:bg-nr-bg-light']}>Releases</a></li>
          <li><a href="/about/conduct/" class:list={['block py-2.5 px-[15px] no-underline border-l-4 transition-all duration-200', Astro.params.slug === 'conduct' ? 'border-l-nr-red bg-white font-semibold text-[#666]' : 'border-[#eee] text-[#666] hover:border-l-nr-red hover:bg-nr-bg-light']}>Code of Conduct</a></li>
          <li><a href="/about/resources/" class:list={['block py-2.5 px-[15px] no-underline border-l-4 transition-all duration-200', Astro.params.slug?.startsWith('resources') ? 'border-l-nr-red bg-white font-semibold text-[#666]' : 'border-[#eee] text-[#666] hover:border-l-nr-red hover:bg-nr-bg-light']}>Resources</a></li>
        </ul>
      </nav>
    </aside>

    <div class="about-content bg-white p-10 rounded-lg shadow-sm lt-md:p-[25px]">
      <h1 class="text-[28px] mb-5 pb-[15px] border-b-3 border-nr-red">{page.data.title}</h1>
      <Content />
    </div>
  </div>
</BaseLayout>

<style>
  /* Breadcrumb separator pseudo-elements */
  .nr-breadcrumbs-inner li::before {
    content: '/';
    color: rgba(255, 255, 255, 0.6);
    margin: 0 10px;
  }

  .nr-breadcrumbs-inner li:first-child::before {
    content: '';
    margin: 0;
  }

  /* About content rendered markdown â€” must use :global() */
  .about-content :global(h2) {
    font-size: 22px;
    margin: 30px 0 15px;
  }

  .about-content :global(p) {
    margin: 15px 0;
    line-height: 1.7;
  }

  .about-content :global(ul),
  .about-content :global(ol) {
    margin: 15px 0;
    padding-left: 30px;
  }

  .about-content :global(li) {
    margin: 8px 0;
  }

  .about-content :global(img) {
    max-width: 100%;
    height: auto;
  }

  .about-content :global(.grid) {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin: 20px 0;
  }

  .about-content :global(.col-1-2) {
    min-width: 0;
  }

  .about-content :global(.doc-callout) {
    background: #faf5f5;
    border-left: 4px solid #C75050;
    padding: 16px 20px;
    margin: 20px 0;
    border-radius: 0 4px 4px 0;
  }

  @media (max-width: 600px) {
    .about-content :global(.grid) {
      grid-template-columns: 1fr;
    }
  }
</style>

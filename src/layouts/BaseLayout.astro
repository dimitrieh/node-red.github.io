---
import { mainNav, footerLinks } from '../data/navigation';

interface Props {
  title: string;
  description?: string;
}

const { title, description = 'Low-code programming for event-driven applications' } = Astro.props;
const currentPath = Astro.url.pathname;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <title>{title} - Node-RED</title>
    <link rel="icon" href="/favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Roboto+Slab:wght@400;600;700&family=Ubuntu+Mono&display=swap"
      rel="stylesheet"
    />
  </head>
  <body class="font-sans text-[17px] leading-[1.7] text-nr-text bg-nr-bg-light min-h-screen flex flex-col m-0">
    <a href="#main-content" class="absolute top-[-100%] left-4 bg-nr-red text-white px-4 py-2 rounded-b-lg z-[1000] font-semibold no-underline focus:top-0">Skip to main content</a>

    <header class="bg-nr-bg-dark border-b-3 border-nr-red sticky top-0 z-100">
      <div class="max-w-[1200px] mx-auto flex items-center justify-between px-5 h-16">
        <div class="shrink-0">
          <a href="/" class="flex items-center gap-3 no-underline hover:no-underline">
            <img src="/node-red-icon.png" alt="" width="40" height="40" class="w-10 h-10" />
            <span class="font-heading font-bold text-[20px] text-nr-text-light">Node-RED</span>
          </a>
        </div>

        <nav class="flex gap-0 lt-lg:hidden" aria-label="Main navigation">
          {mainNav.map((item) => (
            <a
              href={item.href}
              class:list={[
                'font-heading text-[15px] text-[#C0C0C0] no-underline py-[22px] px-[14px] border-b-3 border-transparent mb-[-3px] transition-all duration-200 hover:text-nr-text-light hover:border-b-nr-red hover:no-underline',
                { 'text-nr-text-light! border-b-nr-red!': item.href === '/' ? currentPath === '/' : currentPath.startsWith(item.href) && !item.external }
              ]}
              {...(item.external ? { target: '_blank', rel: 'noopener noreferrer' } : {})}
              {...(!item.external && (item.href === '/' ? currentPath === '/' : currentPath.startsWith(item.href)) ? { 'aria-current': 'page' } : {})}
            >
              {item.label}
            </a>
          ))}
        </nav>

        <button class="hidden lt-lg:block bg-transparent border-none text-[#C0C0C0] cursor-pointer p-2 hover:text-nr-text-light nr-mobile-toggle" aria-label="Toggle menu" aria-expanded="false">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </button>
      </div>

      <nav class="hidden flex-col bg-nr-bg-dark px-5 pb-5 mobile-nav" aria-label="Mobile navigation" aria-hidden="true">
        {mainNav.map((item) => (
          <a
            href={item.href}
            class:list={[
              'font-heading text-[15px] text-[#C0C0C0] no-underline py-3 border-b border-[#333] mb-0 transition-all duration-200 hover:text-nr-text-light hover:no-underline',
              { 'text-nr-text-light!': item.href === '/' ? currentPath === '/' : currentPath.startsWith(item.href) && !item.external }
            ]}
            {...(item.external ? { target: '_blank', rel: 'noopener noreferrer' } : {})}
          >
            {item.label}
          </a>
        ))}
      </nav>
    </header>

    <main id="main-content" class="flex-1">
      <slot />
    </main>

    <footer class="bg-nr-bg-dark text-nr-text-light mt-auto" aria-label="Site footer">
      <div class="max-w-[1200px] mx-auto py-12 px-5 grid grid-cols-[1fr_2fr] gap-12 lt-md:grid-cols-1">
        <div>
          <a href="/" class="flex items-center gap-3 no-underline text-nr-text-light font-heading text-[24px] font-bold hover:no-underline">
            <img src="/node-red-icon.png" alt="" width="50" height="50" class="w-[50px] h-[50px]" />
            <span>Node-RED</span>
          </a>
          <p class="text-[#888] mt-3 text-sm">Low-code programming for event-driven applications</p>
        </div>

        <div class="grid grid-cols-3 gap-8 lt-md:grid-cols-2 lt-sm:grid-cols-1">
          {footerLinks.map((section) => (
            <div>
              <p class="font-heading text-[15px] font-semibold mb-4 text-nr-text-light">{section.title}</p>
              <ul class="list-none p-0 m-0">
                {section.links.map((link) => (
                  <li class="my-2">
                    <a href={link.href} class="text-[#999] text-sm no-underline transition-colors duration-200 hover:text-nr-text-light hover:no-underline">{link.label}</a>
                  </li>
                ))}
              </ul>
            </div>
          ))}
        </div>
      </div>

      <div class="bg-[#161616] py-5">
        <div class="max-w-[1200px] mx-auto px-5 flex justify-between items-start gap-5 lt-md:flex-col">
          <p class="text-xs text-[#888] m-0">
            Copyright &copy; OpenJS Foundation and Node-RED contributors. All rights reserved.
            The <a href="https://openjsf.org" class="text-nr-red underline">OpenJS Foundation</a> has registered trademarks and uses trademarks.
            For a list of trademarks of the OpenJS Foundation, please see our <a href="https://trademark-policy.openjsf.org" class="text-nr-red underline">Trademark Policy</a>
            and <a href="https://trademark-list.openjsf.org" class="text-nr-red underline">Trademark List</a>.
            <a href="https://terms-of-use.openjsf.org" class="text-nr-red underline">Terms of Use</a> |
            <a href="https://privacy-policy.openjsf.org" class="text-nr-red underline">Privacy Policy</a> |
            <a href="https://bylaws.openjsf.org" class="text-nr-red underline">Bylaws</a> |
            <a href="https://www.linuxfoundation.org/cookies" class="text-nr-red underline">Cookie Policy</a>
          </p>
          <div class="flex gap-4 shrink-0">
            <a href="https://social.nodered.org/@nodered" target="_blank" rel="noopener noreferrer me" aria-label="Mastodon" class="text-[#999] no-underline transition-colors duration-200 hover:text-nr-text-light">
              <div class="i-simple-icons-mastodon w-5 h-5"></div>
            </a>
            <a href="https://twitter.com/nodered" target="_blank" rel="noopener noreferrer" aria-label="Twitter" class="text-[#999] no-underline transition-colors duration-200 hover:text-nr-text-light">
              <div class="i-simple-icons-x w-5 h-5"></div>
            </a>
            <a href="https://github.com/node-red" target="_blank" rel="noopener noreferrer" aria-label="GitHub" class="text-[#999] no-underline transition-colors duration-200 hover:text-nr-text-light">
              <div class="i-simple-icons-github w-5 h-5"></div>
            </a>
          </div>
        </div>
        <div class="max-w-[1200px] mx-auto px-5 pt-4">
          <a href="https://openjsf.org" target="_blank" rel="noopener noreferrer">
            <img src="/images/openjs_foundation-logo.svg" alt="OpenJS Foundation" class="h-10 opacity-80 transition-opacity duration-200 hover:opacity-100" />
          </a>
        </div>
      </div>
    </footer>

    <script>
      const toggle = document.querySelector('.nr-mobile-toggle');
      const mobileNav = document.querySelector('.mobile-nav');

      toggle?.addEventListener('click', () => {
        const expanded = toggle.getAttribute('aria-expanded') === 'true';
        toggle.setAttribute('aria-expanded', String(!expanded));
        mobileNav?.setAttribute('aria-hidden', String(expanded));
      });
    </script>
  </body>
</html>

<style is:global>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  a {
    color: #C75050;
    text-decoration: none;
    transition: color 0.2s;
  }

  a:hover {
    text-decoration: underline;
    color: #A63D3D;
  }

  h1, h2, h3, h4, h5 {
    font-family: 'Roboto Slab', serif;
    font-weight: 600;
    color: #2D2D2D;
    letter-spacing: -0.01em;
  }

  code {
    font-family: 'Ubuntu Mono', monospace;
    background: #FFF5F5;
    color: #D4394B;
    padding: 2px 8px;
    border-radius: 4px;
  }

  pre {
    background: #1E1E1E;
    color: #D4D4D4;
    padding: 16px 20px;
    border-radius: 8px;
    overflow-x: auto;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  }

  pre code {
    background: none;
    color: inherit;
    padding: 0;
  }

  :focus-visible {
    outline: 3px solid #C75050;
    outline-offset: 2px;
  }

  @media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
  }

  .mobile-nav[aria-hidden="false"] {
    display: flex;
  }
</style>
